import{C as e,D as t,E as n,J as r,L as i,O as a,S as o,T as s,Y as c,_ as l,at as u,b as d,c as f,d as p,dt as m,f as h,ft as g,g as _,h as v,ht as y,k as b,m as x,mt as S,u as C,ut as w,vt as T,w as E,x as D,y as O}from"./index-ziRH-b2S.js";var k=class extends b{constructor(e,t){super(),this.options=t,this.#e=e,this.#s=null,this.#o=_(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#n=void 0;#r=void 0;#i;#a;#o;#s;#c;#l;#u;#d;#f;#p;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),j(this.#t,this.options)?this.#h():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return M(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return M(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#x(),this.#t.removeObserver(this)}setOptions(t){let n=this.options,r=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!=`boolean`&&typeof this.options.enabled!=`function`&&typeof e(this.options.enabled,this.#t)!=`boolean`)throw Error(`Expected enabled to be a boolean or a callback that returns a boolean`);this.#S(),this.#t.setOptions(this.options),n._defaulted&&!s(this.options,n)&&this.#e.getQueryCache().notify({type:`observerOptionsUpdated`,query:this.#t,observer:this});let i=this.hasListeners();i&&N(this.#t,r,this.options,n)&&this.#h(),this.updateResult(),i&&(this.#t!==r||e(this.options.enabled,this.#t)!==e(n.enabled,this.#t)||E(this.options.staleTime,this.#t)!==E(n.staleTime,this.#t))&&this.#g();let a=this.#_();i&&(this.#t!==r||e(this.options.enabled,this.#t)!==e(n.enabled,this.#t)||a!==this.#p)&&this.#v(a)}getOptimisticResult(e){let t=this.#e.getQueryCache().build(this.#e,e),n=this.createResult(t,e);return F(this,n)&&(this.#r=n,this.#a=this.options,this.#i=this.#t.state),n}getCurrentResult(){return this.#r}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),t?.(n),n===`promise`&&(this.trackProp(`data`),!this.options.experimental_prefetchInRender&&this.#o.status===`pending`&&this.#o.reject(Error(`experimental_prefetchInRender feature flag is not enabled`))),Reflect.get(e,n))})}trackProp(e){this.#m.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),n=this.#e.getQueryCache().build(this.#e,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#h(e){this.#S();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(D)),t}#g(){this.#b();let e=E(this.options.staleTime,this.#t);if(O||this.#r.isStale||!d(e))return;let n=t(this.#r.dataUpdatedAt,e)+1;this.#d=a.setTimeout(()=>{this.#r.isStale||this.updateResult()},n)}#_(){return(typeof this.options.refetchInterval==`function`?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(t){this.#x(),this.#p=t,!(O||e(this.options.enabled,this.#t)===!1||!d(this.#p)||this.#p===0)&&(this.#f=a.setInterval(()=>{(this.options.refetchIntervalInBackground||l.isFocused())&&this.#h()},this.#p))}#y(){this.#g(),this.#v(this.#_())}#b(){this.#d&&=(a.clearTimeout(this.#d),void 0)}#x(){this.#f&&=(a.clearInterval(this.#f),void 0)}createResult(t,n){let r=this.#t,i=this.options,a=this.#r,s=this.#i,c=this.#a,l=t===r?this.#n:t.state,{state:u}=t,d={...u},f=!1,p;if(n._optimisticResults){let e=this.hasListeners(),a=!e&&j(t,n),o=e&&N(t,r,n,i);(a||o)&&(d={...d,...x(u.data,t.options)}),n._optimisticResults===`isRestoring`&&(d.fetchStatus=`idle`)}let{error:m,errorUpdatedAt:h,status:g}=d;p=d.data;let v=!1;if(n.placeholderData!==void 0&&p===void 0&&g===`pending`){let e;a?.isPlaceholderData&&n.placeholderData===c?.placeholderData?(e=a.data,v=!0):e=typeof n.placeholderData==`function`?n.placeholderData(this.#u?.state.data,this.#u):n.placeholderData,e!==void 0&&(g=`success`,p=o(a?.data,e,n),f=!0)}if(n.select&&p!==void 0&&!v)if(a&&p===s?.data&&n.select===this.#c)p=this.#l;else try{this.#c=n.select,p=n.select(p),p=o(a?.data,p,n),this.#l=p,this.#s=null}catch(e){this.#s=e}this.#s&&(m=this.#s,p=this.#l,h=Date.now(),g=`error`);let y=d.fetchStatus===`fetching`,b=g===`pending`,S=g===`error`,C=b&&y,w=p!==void 0,T={status:g,fetchStatus:d.fetchStatus,isPending:b,isSuccess:g===`success`,isError:S,isInitialLoading:C,isLoading:C,data:p,dataUpdatedAt:d.dataUpdatedAt,error:m,errorUpdatedAt:h,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>l.dataUpdateCount||d.errorUpdateCount>l.errorUpdateCount,isFetching:y,isRefetching:y&&!b,isLoadingError:S&&!w,isPaused:d.fetchStatus===`paused`,isPlaceholderData:f,isRefetchError:S&&w,isStale:P(t,n),refetch:this.refetch,promise:this.#o,isEnabled:e(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){let e=e=>{T.status===`error`?e.reject(T.error):T.data!==void 0&&e.resolve(T.data)},n=()=>{e(this.#o=T.promise=_())},i=this.#o;switch(i.status){case`pending`:t.queryHash===r.queryHash&&e(i);break;case`fulfilled`:(T.status===`error`||T.data!==i.value)&&n();break;case`rejected`:(T.status!==`error`||T.error!==i.reason)&&n();break}}return T}updateResult(){let e=this.#r,t=this.createResult(this.#t,this.options);this.#i=this.#t.state,this.#a=this.options,this.#i.data!==void 0&&(this.#u=this.#t),!s(t,e)&&(this.#r=t,this.#C({listeners:(()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,n=typeof t==`function`?t():t;if(n===`all`||!n&&!this.#m.size)return!0;let r=new Set(n??this.#m);return this.options.throwOnError&&r.add(`error`),Object.keys(this.#r).some(t=>{let n=t;return this.#r[n]!==e[n]&&r.has(n)})})()}))}#S(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;let t=this.#t;this.#t=e,this.#n=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#C(e){v.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:`observerResultsUpdated`})})}};function A(t,n){return e(n.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status===`error`&&n.retryOnMount===!1)}function j(e,t){return A(e,t)||e.state.data!==void 0&&M(e,t,t.refetchOnMount)}function M(t,n,r){if(e(n.enabled,t)!==!1&&E(n.staleTime,t)!==`static`){let e=typeof r==`function`?r(t):r;return e===`always`||e!==!1&&P(t,n)}return!1}function N(t,n,r,i){return(t!==n||e(i.enabled,t)===!1)&&(!r.suspense||t.state.status!==`error`)&&P(t,r)}function P(t,n){return e(n.enabled,t)!==!1&&t.isStaleByTime(E(n.staleTime,t))}function F(e,t){return!s(e.getCurrentResult(),t)}function I(e=``){if(!r())throw Error(`vue-query hooks can only be used inside setup() function or functions that support injection context.`);let t=c(p(e));if(!t)throw Error(`No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.`);return t}function L(e,t,r){let a=r||I(),o=i(()=>{let e=t;typeof e==`function`&&(e=e());let n=C(e);typeof n.enabled==`function`&&(n.enabled=n.enabled());let r=a.defaultQueryOptions(n);return r._optimisticResults=a.isRestoring?.value?`isRestoring`:`optimistic`,r}),s=new e(a,o.value),c=o.value.shallow?S(s.getCurrentResult()):m(s.getCurrentResult()),l=()=>{};a.isRestoring&&u(a.isRestoring,e=>{e||(l(),l=s.subscribe(e=>{h(c,e)}))},{immediate:!0});let d=()=>{s.setOptions(o.value),h(c,s.getCurrentResult())};u(o,d),w(()=>{l()});let f=(...e)=>(d(),c.refetch(...e)),p=()=>new Promise((e,t)=>{let r=()=>{},i=()=>{if(o.value.enabled!==!1){s.setOptions(o.value);let i=s.getOptimisticResult(o.value);i.isStale?(r(),s.fetchOptimistic(o.value).then(e,r=>{n(o.value.throwOnError,[r,s.getCurrentQuery()])?t(r):e(s.getCurrentResult())})):(r(),e(i))}};i(),r=u(o,i)});u(()=>c.error,e=>{if(c.isError&&!c.isFetching&&n(o.value.throwOnError,[e,s.getCurrentQuery()]))throw e});let _=T(o.value.shallow?y(c):g(c));for(let e in c)typeof c[e]==`function`&&(_[e]=c[e]);return _.suspense=p,_.refetch=f,_}function R(e,t){return L(k,e,t)}const z=e=>e.includes(`http`)?e:`http://localhost:3000/api/files/product/${e}`,B=async(e=1,t=10)=>{try{let{data:n}=await f.get(`/products?limit=${t}&offset=${e*t}`);return n.map(e=>({...e,images:e.images.map(z)}))}catch(e){throw console.log(e),Error(`Error getting products`)}},V=async e=>{if(e===`create`)return{id:``,title:``,slug:``,description:``,price:0,stock:0,images:[],tags:[],sizes:[],gender:``,user:{}};try{let{data:t}=await f.get(`/products/${e}`);return console.log({data:t}),{...t,images:t.images.map(z)}}catch(t){throw console.log(t),Error(`Error getting product by id ${e}`)}},H=async e=>{console.log(`ANTES DE SUBIR IMÁGENES:`,e.images);let t=e.id,n=await K(e.images??[]);console.log(`DESPUÉS DE SUBIR IMÁGENES:`,n),e.images=n,console.log(`ANTES DE MANDAR AL BACKEND:`,e);let r=U(e);return t&&t!==``?await W(t,r):(console.log(`BODY FINAL ENVIADO:`,r),await G(r))};var U=e=>(delete e.id,delete e.user,e),W=async(e,t)=>{try{let{data:n}=await f.patch(`/products/${e}`,t);return n}catch(e){throw console.log(e),Error(`Error actualizando producto`)}},G=async e=>{try{let{data:t}=await f.post(`/products`,e);return t}catch(e){throw console.log(e),Error(`Error creaando producto`)}},K=async e=>{let t=e.filter(e=>e instanceof File),n=e.filter(e=>typeof e==`string`),r=t.map(async e=>{try{let t=new FormData;t.append(`file`,e);let{data:n}=await f.post(`/files/product`,t);return n.secureUrl.replace(`https://`,`http://`)}catch(e){throw console.log(e),Error(`Error actualizando imagenes`)}}),i=await Promise.all(r);return[...n,...i]};export{I as a,R as i,V as n,B as r,H as t};